function [outstim] = loadstim(qts)

StimWindowGlobals;

qts = unloadstim(qts);
QTSp = getparameters(qts);

if exist(QTSp.filename),
	[movie,qts.movieparams.duration,qts.movieparams.fps,qts.movieparams.width,qts.movieparams.height] =...
        Screen('OpenMovie',StimWindow,QTSp.filename);
else,
	error(['Cannot open quicktime movie file ' QTSp.filename '.']);
end;

displayType = 'QUICKTIME'; 
displayProc = 'standard';

dS = {'displayType',displayType,'displayProc',displayProc,...
	'offscreen',0,'frames',0,'depth',8,...
	'clut_usage',ones(1,256),'clut',{},...
	'clut_bg',repmat(QTSp.background,256,1),'userfield',struct('movie',[movie],'movieparams',movieparams)};

if (QTSp.rect(3)-QTSp.rect(1))*(QTSp.rect(4)-QTSp.rect(2))>=4,
    % nothing needs to be done
    rect = QTSp.rect;
else,
    ctr = [ mean(QTSp.rect([3 1])) mean(QTSp.rect([2 4])) mean(QTSp.rect([3 1])) mean(QTSp.rect([4 2]))];
    rect = [0 0 qts.movieparams.width qts.movieparams.height] + [ctr];
end;

dps = struct(getDisplayPrefs(qts));
newdp = {'rect', rect,T


outstim = qts;

outstim.stimulus = setdisplaystruct(outstim.stimulus,displaystruct(dS));
outstim.stimulus = loadstim(outstim.stimulus);
